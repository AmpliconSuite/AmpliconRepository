{% extends 'base.html' %}

{% load mezzanine_tags %}
{% load custom_filters %}
{% block extra_css %}
<style>
    /* Search Slider Styles */
    .search-slider {
        position: fixed;
        left: 0;
        top: 50%;
        transform: translate(-350px, -50%);
        width: 350px;
        max-height: 90vh;
        background-color: white;
        box-shadow: 2px 0 10px rgba(0,0,0,0.1);
        transition: transform 0.3s ease-in-out;
        z-index: 1000;
        overflow-y: auto;
        border-radius: 0 8px 8px 0;
        border: 1px solid #e0e0e0;
        border-radius: 5px;
        
    }
    
    .search-slider.open {
        transform: translate(0, -50%);
    }
    
    .search-slider-toggle {
        position: fixed;
        left: 0;
        top: 50%;
        transform: translateY(-50%);
        width: 40px;
        height: 60px;
        background-color: #0275d8;
        color: white;
        border: none;
        border-radius: 0 5px 5px 0;
        cursor: pointer;
        font-size: 18px;
        z-index: 999;
        box-shadow: 2px 2px 5px rgba(0,0,0,0.2);
        transition: left 0.3s ease-in-out;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    .search-slider-toggle i {
        pointer-events: none;
    }
    
    .search-slider.open + .search-slider-toggle {
        left: 350px;
    }
    
    .search-slider-toggle:hover {
        background-color: #025aa5;
    }
    
    .search-slider-content {
        padding: 2px;
        
    }
</style>
{% endblock %}

{% block extra_js %}
<script>
    // get the format and sort functions from the included file
    {% include 'includes/datatable_date_utils.html' %}

    $(document).ready(function () {
        $('a[data-toggle="tab"]').on('shown.bs.tab', function (e) {
            $.fn.dataTable.tables({ visible: true, api: true }).columns.adjust();
        });
     
        $('#projectTable0').DataTable({
            language: {
                    searchPlaceholder: "Search projects"
                    },
            columnDefs: [
                {
                    targets: 2, // 3rd column (zero-based index)
                    type: 'custom-date'
                }
            ],
            order: [[2, 'desc']] // Sort by date column (index 2) in descending order
        });
        $('#projectTable1').DataTable({
            language: {
                    searchPlaceholder: "Search projects"
                    },
            columnDefs: [
                {
                    targets: 2, // 3rd column (zero-based index)
                    type: 'custom-date'
                }
            ],
            order: [[2, 'desc']] // Sort by date column (index 2) in descending order

        });
        $('#projectTable2').DataTable({
            language: {
                    searchPlaceholder: "Search projects"
                    },
            columnDefs: [
                {
                    targets: 2, // 3rd column (zero-based index)
                    type: 'custom-date'
                }
            ],
            order: [[2, 'desc']] // Sort by date column (index 2) in descending order
        });
    });
    // Call the formatDates function when the page is loaded
    document.addEventListener('DOMContentLoaded', formatDates);
    
    window.addEventListener('DOMContentLoaded', function() {
        var tabContent = document.getElementById('tab-table0');
        if (tabContent.scrollWidth > tabContent.clientWidth) {
            tabContent.style.overflowX = 'scroll';
        } else {
            tabContent.style.overflowX = 'hidden';
        }
    });

    // Search Slider Toggle
    $(document).ready(function() {
        $('#search-slider-toggle').on('click', function() {
            $('#search-slider').toggleClass('open');
        });
        
        // Close slider when clicking outside
        $(document).on('click', function(event) {
            if (!$(event.target).closest('#search-slider, #search-slider-toggle').length) {
                $('#search-slider').removeClass('open');
            }
        });
    });
   
</script>


{% endblock %}

{% block meta_title %} Home
{% endblock %}

{% block index %}

<head>
    <title>
        AmpliconRepository
    </title>
</head>

    <!-- Search Slider -->
    <div id="search-slider" class="search-slider">
        <div class="search-slider-content">
            <div class="search-box" style="padding: 20px; background-color: #f8f9fa; border-radius: 5px; font-size: 0.9em;">
                {% include 'includes/searchbox.html' %}
            </div>
        </div>
    </div>
    <button id="search-slider-toggle" class="search-slider-toggle" aria-label="Toggle search">
        <i class="fas fa-search"></i>
    </button>

    <div class="container main-container row" style="max-width:1400px; width:90%; margin:auto;">
    <div class="col-md-8">


        <style>
            .nav-tabs .nav-link {
                color: gray;
                border: 0;
                border-bottom: 1px solid grey;
            }
            
            .nav-tabs .nav-link:hover {
                border: 0;
                border-bottom: 1px solid grey;
            }
            
            .nav-tabs .nav-link.active {
                color: #000000;
                border: 0;
                border-radius: 0;
                border-bottom: 2px solid  #0275d8 ;
            }

            .col-lg-3 {
                padding:0px
            }
        </style>
            <div style="margin-top: 20px">
                <img src="{{ STATIC_URL }}img/AmpliconRepository_Grey.png" width="100%">
                <hr>
                <div stlye="margin-top: 30px;">
                    <p style="font-size:18px;">An online repository of AmpliconArchitect outputs. Explore and download focal amplification predictions and annotations.</p>
                </div>
                <div class="row">
                    <div class="col-lg-3">
                        <div class="card text-center" style="width:12rem; border:none;margin:auto; padding: 5px">
				<img class="card-img-top" src="{{ STATIC_URL }}img/250w/exploration_cartoonAsset_1.png" style="max-height:20rem; max-width:10rem; margin:auto">
                            <div class="card-body" style="margin-top:5px">
                                <p class="card-title">Copy-number data exploration</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-3">
                        <div class="card text-center" style="width: 12rem; border:none;margin:auto; padding: 5px">
                            <img class="card-img-top" src="{{ STATIC_URL }}img/250w/aa_viz_cartoonAsset_1.png" style="max-height:20rem; max-width:10rem; margin:auto">
                            <div class="card-body" style="margin-top:18px">
                                <p class="card-title">AmpliconArchitect output files</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-3">
                        <div class="card text-center" style="width: 12rem; border:none;margin:auto; padding: 5px">
                            <img class="card-img-top" src="{{ STATIC_URL }}img/250w/classes_cartoonAsset_1.png" style="max-height:20rem; max-width:10rem; margin:auto">
                            <div class="card-body" style="margin-top:18px">
                                <p class="card-title">Focal amplification classifications</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-3">
                        <div class="card text-center" style="width: 14rem; border:none;margin:auto; padding: 5px">
                            <img class="card-img-top" src="{{ STATIC_URL }}img/250w/gene_coords_cartoonAsset_1.png" style="max-height:20rem; max-width:6rem; margin:auto">
                            <div class="card-body" style="margin-top:3px">
                                <p class="card-title">Amplicon coordinates and gene contents</p>
                            </div>
                        </div>
                    </div>
            
                </div>
        </div>
        <hr>
        <div style="margin-bottom: 20px; border: 0.5px solid grey; padding: 20px; border-radius: 10px;">
            <div>
                <div>
                    <ul class="nav nav-tabs" role="tablist">
                        <li class="nav-item">
                            <a class="nav-link active" href="#tab-table0" data-toggle="tab">Featured Projects</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#tab-table1" data-toggle="tab">Public Projects</a>
                        </li>
                        {% if user.is_authenticated %}
                            <li class="nav-item">
                                <a class='nav-link' href="#tab-table2" data-toggle="tab">Private Projects</a>
                            </li>
                        {% endif %}
                    </ul>
                    <div class="tab-content" style="padding-top: 30px;">
                        <div class="tab-pane active" id="tab-table0" style="overflow-x: auto;">
                            <table id='projectTable0' class="table" style="padding-top: 20px; width:100%">
                                <thead>
                                    <tr>
                                        <th>Name</th>
                                        <th>Description</th>
                                        <th>Last Updated</th>
                                        <th>Sample count</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for project in featured_projects %}
                                    <tr>
                                        <td style="white-space: normal; word-break: normal; overflow-wrap: anywhere;">
                                          <a target="_blank" href="{% url 'project_page' project_name=project.linkid %}">{{ project.project_name }}</a>
                                        </td>
                                        <td style="white-space: normal; word-break: normal; overflow-wrap: anywhere;">{{ project.description|truncatechars:100 }}</td>
                                        <td class="date">{{ project.date }}</td>
                                        <td>{{ project.sample_count }}</td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>

                        <div class="tab-pane " id="tab-table1" style="overflow-x: auto;">
                            <table name='projectTable1' id='projectTable1' class="table" style="padding-top: 20px; width:100%">
                                <thead>
                                    <tr>
                                        <th>Name</th>
                                        <th>Description</th>
                                        <th>Last Updated</th>
                                        <th>Sample count</th>

                                    </tr>
                                </thead>
                                <tbody>
                                    {% for project in public_projects %}
                                    <tr>
                                        <td style="white-space: normal; word-break: normal; overflow-wrap: anywhere;">
                                          <a target="_blank" href="{% url 'project_page' project_name=project.linkid %}">{{ project.project_name }}</a>
                                        </td>
                                        <td style="white-space: normal; word-break: normal; overflow-wrap: anywhere;">{{ project.description|truncatechars:100 }}</td>
                                        <td class="date">{{ project.date }}</td>
                                        <td>{{ project.sample_count }}</td>

                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                        {% if user.is_authenticated %}
                        <div class="tab-pane" id="tab-table2" style="overflow-x: auto;">
                            <table id='projectTable2' class="table" style="padding-top: 20px; width:100%">
                                <thead>
                                    <tr>
                                        <th>Name</th>
                                        <th>Description</th>
                                        <th>Last Updated</th>
                                        <th>Project Members</th>
                                        <th>Sample count</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for project in private_projects %}
                                    <tr>
                                        <td style="white-space: normal; word-break: normal; overflow-wrap: anywhere;">
                                          <a target="_blank" href="{% url 'project_page' project_name=project.linkid %}">{{ project.project_name }}</a>
                                        </td>
                                        <td style="white-space: normal; word-break: normal; overflow-wrap: anywhere;">{{ project.description|truncatechars:100 }}</td>
                                        <td class="date" >{{ project.date }}</td>
                                        <td>{% for person in project.project_members %}
                                            {{ person }}<br>
                                        {% endfor%}</td>
                                        <td>{{ project.sample_count }}</td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
        
    </div>
    <div class="col-md-4">
        <br>
        <h4 style="margin-top: 20px">News & Updates</h4>

        <ul>
            <li style="margin-bottom:10px">
                <a href="https://www.nature.com/articles/s41588-024-01949-7" target="_blank">Leveraging large-scale genomic datasets to track extrachromosomal DNA across cancer stages <i class="fas fa-external-link-alt"></i></a>
            </li>
            <li style="margin-bottom:10px">
                <a href="https://www.nature.com/articles/s41588-023-01551-3" target="_blank">Study of ecDNA in medulloblastoma reveals intratumor heterogeneity of ecDNA <i class="fas fa-external-link-alt"></i></a>
            </li>
            <li style="margin-bottom:10px">
                <a href="https://www.nature.com/articles/d41586-023-00982-6" target="_blank">Study of ecDNA in Barrett's esophagus patients shows ecDNA arises early in cancer development <i class="fas fa-external-link-alt"></i></a>
            </li>
            <li>
                <a href="https://www.nih.gov/news-events/news-releases/four-multinational-interdisciplinary-teams-selected-address-major-challenges-cancer" target="_blank">Team eDyNAmiC receives $25 million grant to study the role of ecDNA in cancer <i class="fas fa-external-link-alt"></i></a>
            </li>
        </ul>
        <div id="accordion" >
            <div class="card">
                <style>
                    .btn-link:not([aria-expanded="false"]).collapsed::before {
                        content: "";
                        display: inline-block;
                        border-style: solid;
                        border-width: 0.4em 0 0.4em 0.4em;
                        border-color: transparent transparent transparent #000;
                        margin-right: 0.5em;
                        transform: rotate(0deg);
                        vertical-align: middle;
                    }

                    .btn-link[aria-expanded="true"]::before {
                        content: "";
                        display: inline-block;
                        border-style: solid;
                        border-width: 0.4em 0 0.4em 0.4em;
                        border-color: transparent transparent transparent #000;
                        margin-right: 0.5em;
                        transform: rotate(90deg);
                        vertical-align: middle;
                    }

                    .btn-link:not([aria-expanded="true"]).collapsed::before {
                        content: "";
                        display: inline-block;
                        border-style: solid;
                        border-width: 0.4em 0 0.4em 0.4em;
                        border-color: transparent transparent transparent #000;
                        margin-right: 0.5em;
                        transform: rotate(0deg);
                        vertical-align: middle;
                    }

                    .table-not-striped tbody tr:nth-of-type(odd) {
                        background-color: transparent!important;
                    }
                    .table-not-striped  th {
                        background-color: #E6EFFB;
                        color: #696a6c
                    }
                    .table-not-striped td {
                        color: #696a6c
                    }
                </style>

              <div class="card-header" id="headingOne" style="background:none;">
                <h4 class="mb-0">
                    <button class="btn btn-link collapsed" data-toggle="collapse" data-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne" style="padding: 0.25rem 0.5rem; font-weight: bold;">How to cite AmpliconRepository</button>
                </h4>
              </div>

              <div id="collapseOne" class="collapse" aria-labelledby="headingOne" data-parent="#accordion" >
                <div class="card-body">
                    <a href="https://www.biorxiv.org/content/10.1101/2024.05.06.592768v1" target="_blank">Luebeck J, Huang E, et al. "AmpliconSuite: an end-to-end workflow for analyzing focal amplifications in cancer genomes." bioRxiv. 2024.</a>
                    <br>
                    <br>
                    To cite results obtained from the site, please refer to the uploader's associated publication where possible.
                </div>
              </div>
            </div>
        </div>
        <div>
            <h4 style="margin-top: 20px; font-size: 1.2em;">What's publicly available?</h4>
            <hr style="max-width: 60%; margin-left: 0;">
            <div style="margin-left: 0%;">
                <table id='statsTable0' class="table table-borderless table-sm table-not-striped" style="padding-top: 20px; width:100%">
                    <col width="50%">
                    <col width="50%">
                    <tbody>
                        <tr>
                            <td style="font-size: 1em;">Projects</td>
                            <td style="font-size: 1em;">{{ site_stats.public_proj_count|default:0 }}</td>
                        </tr>
                        <tr>
                            <td style="font-size: 1em;">Samples</td>
                            <td style="font-size: 1em;">{{ site_stats.public_sample_count|default:0 }}</td>
                        </tr>
                    </tbody>
                </table>
                <hr style="max-width: 60%; margin-left: 0;">
                <p style="font-size: 1em;">Focal amplification counts</p>
                <table id='statsTable1' class="table table-borderless table-sm table-not-striped" style="padding-top: 20px; width:100%">
                    <col width="50%">
                    <col width="50%">
                    <tbody>
                        <tr>
                            <td style="font-size: 1em;">ecDNA</td>
                            <td style="font-size: 1em;">{{ site_stats.public_amplicon_classifications_count.ecDNA|default:0 }}</td>
                        </tr>
                        <tr>
                            <td style="font-size: 1em;">BFB</td>
                            <td style="font-size: 1em;">{{ site_stats.public_amplicon_classifications_count.BFB|default:0 }}</td>
                        </tr>
                        <tr>
                            <td style="font-size: 1em;">Other fsCNA</td>
                            <td style="font-size: 1em;">{{ site_stats.public_amplicon_classifications_count.otherfscna|default:0 }}</td>
                        </tr>
                    </tbody>
                </table>
                
            <!--
            <hr style="max-width: 60%; margin-left: 0;">
                <p style="font-size: 1em;">Tissue of origin sample counts</p>
                <table id='statsTable2' class="table table-borderless table-sm table-not-striped" style="padding-top: 20px; width:100%">
                    <col width="50%">
                    <col width="50%">
                    <tbody>
                        {% for tissue_name, count in site_stats.public_tissue_of_origin_count|sort_dict_by_value_desc %}
                        <tr>
                            <td style="font-size: 1em;">{{ tissue_name }}</td>
                            <td style="font-size: 1em;">{{ count|default:0 }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                -->
            </div>
        </div>


    </div>
</div>


{% endblock index %}


{% block main %}
{% endblock %}
