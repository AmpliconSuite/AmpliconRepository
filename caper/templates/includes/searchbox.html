{% load static %}

<head>
    <style>
        #searchDropdown {
            display: none;
            background: white;
            border: 1px solid #ddd;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 1rem;
            position: absolute;
            top: 100%;
            right: 0;
            min-width: 300px;
            z-index: 1000;
        }

        #searchDropdown.is-hidden {
            display: none !important;
        }
        
        /* Ensure dropdown moves left if it overflows */
        @media (max-width: 768px) {
            #searchDropdown {
                left: auto;
                right: 5px; /* Add padding from the right */
                max-width: 85vw; /* Prevent full screen width */
            }
        }
        
        /* Keep dropdown aligned properly */
        .navbar-item.has-dropdown:hover .navbar-dropdown {
            left: auto;
            right: 0; /* Align to right edge */
            display: block;
        }

        
    </style>
</head>


<form id="searchForm" action="{% url 'search_results' %}" method="POST" class="p-4 border rounded bg-light">
    {% csrf_token %}

    <div class="mb-3">
        <label for="genequery" class="form-label">Gene Name</label>
        <input type="text" class="form-control" placeholder="Gene Name (e.g. MYC)" name="genequery" id="genequery">
    </div>

    <div class="mb-3">
        <label for="project_name" class="form-label">Project Name</label>
        <input type="text" class="form-control" name="project_name" id="project_name" placeholder="Enter project name...">
    </div>

    <div class="mb-3">
        <label for="classquery" class="form-label">Classification Type</label>
        <input type="text" autocomplete="off" list="ecDNAclassificationDefaults" class="form-control" placeholder="Limit to classification type" name="classquery" id="classquery">
        <datalist id="ecDNAclassificationDefaults">
            <option value="ecDNA">ecDNA</option>
            <option value="linear amplification">linear amplification</option>
            <option value="BFB">Breakage-Fusion-Bridge (BFB)</option>
            <option value="complex non-cyclic">Complex Non-Cyclic</option>
        </datalist>
    </div>

    <div class="mb-3">
        <label for="metadata" class="form-label">Metadata Keywords</label>
        <input type="text" class="form-control" name="metadata" id="metadata" placeholder="Metadata keywords...">
    </div>

    <div class="d-grid">
        <button type="submit" class="btn btn-primary">Search</button>
    </div>
</form>

{% comment %} <!-- Include new JS file -->
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const searchForm = document.getElementById("searchForm");
    
        searchForm.addEventListener("submit", function (event) {
            event.preventDefault(); // Prevent default form submission
    
            let formData = new FormData(searchForm);
    
            fetch(searchForm.action, {
                method: "POST",
                body: formData,
                headers: {
                    "X-CSRFToken": document.querySelector("[name=csrfmiddlewaretoken]").value
                }
            })
            .then(response => {
                if (response.redirected) {
                    window.location.href = response.url; // Redirect to the search results page
                }
            })
            .catch(error => console.error("Error:", error));
        });
    });



</script> {% endcomment %}

<script>

    document.addEventListener("DOMContentLoaded", function () {
        const searchButton = document.getElementById("toggleSearchDropdown");
        const searchDropdown = document.getElementById("searchDropdown");
    
        searchButton.addEventListener("click", function (event) {
            event.preventDefault();
            // Toggle visibility
            if (searchDropdown.style.display === "none" || searchDropdown.style.display === "") {
                searchDropdown.style.display = "block";
    
                // Ensure dropdown stays within viewport
                const rect = searchDropdown.getBoundingClientRect();
                if (rect.right > window.innerWidth) {
                    searchDropdown.style.left = "auto";
                    searchDropdown.style.right = "0"; // Align to the right edge of the screen
                }
            } else {
                searchDropdown.style.display = "none";
            }
        });
    
        // Close dropdown when clicking outside
        document.addEventListener("click", function (event) {
            if (!searchDropdown.contains(event.target) && !searchButton.contains(event.target)) {
                searchDropdown.style.display = "none";
            }
        });
    });
    
</script>
